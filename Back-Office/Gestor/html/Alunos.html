<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Alunos - LABRATS</title>

  <!-- CSS global do back-office -->
  <link rel="stylesheet" href="../css/styleDashboard.css" />
  <link rel="icon" href="../Imagens/Logo.png" type="image/x-icon" />

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-SP70GQF1B5"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-SP70GQF1B5');
  </script>
</head>
<body>
  <!-- SIDEBAR -->
  <aside class="sidebar" style="background-color: #D8ECFF;">
    <div class="logo">
      <img src="../Imagens/Logo.png" alt="LABRATS" />
    </div>

    <nav>
      <ul>
        <li><a data-page="Geral.html" href="Geral.html">ğŸ  VisÃ£o Geral</a></li>
        <li><a data-page="Horario.html" href="Horario.html">ğŸ—“ï¸ HorÃ¡rio</a></li>
        <li><a class="active" data-page="Alunos.html" href="Alunos.html">ğŸ‘¥ Alunos</a></li>
        <li><a data-page="Conteudos.html" href="Conteudos.html">ğŸ“š ConteÃºdos</a></li>
      </ul>
    </nav>

    <div class="add-auditoria">
      <a href="AddConteudos.html">
        <button>+ Adicionar ConteÃºdo</button>
      </a>
    </div>

    <div class="user-info">
      <p id="user-name">VersÃ£o MVP</p>
      <p id="user-email">Sem e-mail</p>
    </div>
  </aside>

  <!-- Backdrop para o drawer em mobile -->
  <div class="sidebar-backdrop" onclick="toggleSidebar()"></div>

  <!-- CONTEÃšDO PRINCIPAL -->
  <main class="content">
    <header class="content-header">
      <!-- BotÃ£o menu (aparece em mobile) -->
      <button class="menu-toggle" type="button" onclick="toggleSidebar()" aria-label="Abrir menu">
        <svg width="24" height="24" viewBox="0 0 24 24">
          <path d="M3 6h18M3 12h18M3 18h18"
                stroke="#111827"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round" />
        </svg>
      </button>

      <h1>Alunos</h1>
    </header>

    <section class="students-container">
      <div class="students-header-row">
        <h2>Alunos com mensagens</h2>
        <span class="students-hint">
          Ordenado pelo aluno que aguarda resposta hÃ¡ mais tempo.
        </span>
      </div>

      <ul id="students-list" class="students-list">
        <!-- Os alunos sÃ£o inseridos via JavaScript -->
      </ul>
    </section>
  </main>

  <script>
    // === Drawer da sidebar em mobile ===
    function toggleSidebar() {
      const sidebar = document.querySelector('.sidebar');
      const backdrop = document.querySelector('.sidebar-backdrop');
      sidebar.classList.toggle('sidebar-open');
      backdrop.classList.toggle('show');
    }

    // === Dados fictÃ­cios (podes trocar por dados reais do backend) ===
    const students = [
      {
        id: 1,
        name: 'David Silva',
        exercisesDone: '2/4',
        lastMessage: '2025-11-20T17:30:00', // ISO
        hasUnread: true
      },
      {
        id: 2,
        name: 'Ana Costa',
        exercisesDone: '0/4',
        lastMessage: '2025-11-19T10:15:00',
        hasUnread: true
      },
      {
        id: 3,
        name: 'JoÃ£o Pereira',
        exercisesDone: '4/6',
        lastMessage: '2025-11-22T15:00:00',
        hasUnread: false
      },
      {
        id: 4,
        name: 'Marta Rocha',
        exercisesDone: '5/5',
        lastMessage: '2025-11-18T09:00:00',
        hasUnread: true
      }
    ];

    // Ordenar pelo aluno que estÃ¡ hÃ¡ mais tempo sem resposta (mensagem mais antiga primeiro)
    students.sort((a, b) => {
      return new Date(a.lastMessage) - new Date(b.lastMessage);
    });

    const listEl = document.getElementById('students-list');

    function timeAgoString(dateStr) {
      const now = new Date();
      const date = new Date(dateStr);
      const diffMs = now - date;

      const diffMinutes = Math.floor(diffMs / 60000);
      const diffHours = Math.floor(diffMinutes / 60);
      const diffDays = Math.floor(diffHours / 24);

      if (diffMinutes < 1) return 'hÃ¡ instantes';
      if (diffMinutes < 60) return `hÃ¡ ${diffMinutes} min`;
      if (diffHours < 24) return `hÃ¡ ${diffHours} h`;
      if (diffDays === 1) return 'hÃ¡ 1 dia';
      return `hÃ¡ ${diffDays} dias`;
    }

    function getInitials(name) {
      return name
        .split(' ')
        .filter(Boolean)
        .map(part => part[0].toUpperCase())
        .slice(0, 2)
        .join('');
    }

    // Render da lista de alunos
    students.forEach(student => {
      if (!student.lastMessage) return;

      const li = document.createElement('li');
      li.className = 'student-item';
      li.dataset.id = student.id;

      li.innerHTML = `
        <div class="student-main">
          <div class="student-avatar">${getInitials(student.name)}</div>
          <div class="student-text">
            <h3 class="student-name">${student.name}</h3>
            <p class="student-meta">
              ExercÃ­cios realizados: <strong>${student.exercisesDone}</strong>
            </p>
          </div>
        </div>
        <div class="student-alert">
          ${
            student.hasUnread
              ? `
                <span class="message-dot"></span>
                <span class="message-text">
                  Nova mensagem ${timeAgoString(student.lastMessage)}
                </span>
              `
              : `
                <span class="message-text message-text-muted">
                  Ãšltima mensagem ${timeAgoString(student.lastMessage)}
                </span>
              `
          }
        </div>
      `;

      // Clicar no aluno -> abre pÃ¡gina de detalhe (Aluno.html)
      li.addEventListener('click', () => {
        window.location.href = `Aluno.html?id=${student.id}`;
      });

      listEl.appendChild(li);
    });
  </script>
</body>
</html>
